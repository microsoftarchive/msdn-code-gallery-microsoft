<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="readme_files/filelist.xml">
<title>Extended Monster Driver Sample</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="State"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="place"/>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Dave Parsons</o:Author>
  <o:Template>Normal</o:Template>
  <o:LastAuthor>Microsoft Employee</o:LastAuthor>
  <o:Revision>8</o:Revision>
  <o:TotalTime>555</o:TotalTime>
  <o:Created>2004-02-02T22:15:00Z</o:Created>
  <o:LastSaved>2005-12-19T06:12:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>651</o:Words>
  <o:Characters>3712</o:Characters>
  <o:Company>Microsoft Corp.</o:Company>
  <o:Lines>30</o:Lines>
  <o:Paragraphs>8</o:Paragraphs>
  <o:CharactersWithSpaces>4355</o:CharactersWithSpaces>
  <o:Version>11.6408</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Zoom>BestFit</w:Zoom>
  <w:HideSpellingErrors/>
  <w:HideGrammaticalErrors/>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-alt:\5B8B\4F53;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:1 135135232 16 0 262144 0;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:1627421319 -2147483648 8 0 66047 0;}
@font-face
	{font-family:"\@SimSun";
	panose-1:0 0 0 0 0 0 0 0 0 0;
	mso-font-alt:"\@Arial Unicode MS";
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-format:other;
	mso-font-pitch:auto;
	mso-font-signature:1 135135232 16 0 262144 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:black;}
h1
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:1;
	font-size:24.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:SimSun;
	color:black;
	font-weight:bold;}
h2
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:2;
	font-size:18.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:SimSun;
	color:black;
	font-weight:bold;}
h3
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:3;
	font-size:13.5pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:SimSun;
	color:black;
	font-weight:bold;}
p.MsoCommentText, li.MsoCommentText, div.MsoCommentText
	{mso-style-noshow:yes;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:black;}
span.MsoCommentReference
	{mso-style-noshow:yes;
	mso-ansi-font-size:8.0pt;
	mso-bidi-font-size:8.0pt;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
p
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:black;}
pre
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Courier New";
	color:black;}
p.MsoCommentSubject, li.MsoCommentSubject, div.MsoCommentSubject
	{mso-style-noshow:yes;
	mso-style-parent:"Comment Text";
	mso-style-next:"Comment Text";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:black;
	font-weight:bold;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-noshow:yes;
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:8.0pt;
	font-family:Tahoma;
	mso-fareast-font-family:"Times New Roman";
	color:black;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="11266"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body bgcolor=white lang=EN-US link=blue vlink=blue style='tab-interval:.5in'
leftmargin=8>

<div class=Section1>

<h1>Extended WIA Monster Driver Sample</h1>

<h1><span style='font-size:14.0pt;mso-bidi-font-size:24.0pt;color:red'>[This is
preliminary documentation and subject to change.]<o:p></o:p></span></h1>

<h3>SUMMARY</h3>

<p>This sample shows how to write a WIA driver that uses the new stream-based
transfer model. It also shows an implementation of a very simple segmentation filter,
image processing filter, and error handling extension for the WIA driver. In
addition, the sample shows how to author an INF file that installs and
registers the extensions with the driver.</p>

<p>The Extended WIA Monster Driver consists of the following components:</p>

<p><b>User-Mode Driver (Minidriver):</b> The user-mode driver (minidriver) is
the actual user-mode driver, which supports the new stream-based transfer
model.</p>

<p><b>Segmentation Filter:</b> The segmentation filter is intended for
illustrational purposes only. It &quot;detects&quot; three pre-determined
regions and creates a child item for each setting in the item’s XPOS, YPOS,
XEXTENT, YEXTENT, and DESKEW properties.</p>

<p><b>Image Processing Filter:</b> The image processing filter is intended for
illustrational purposes only. It uses GDI+ to cut out the desired image region
and rotate and deskew the image, if needed. GDI+ is also used to modify the
contrast and brightness of the image. One shortcoming with this simple image
processing filter is that it is not capable of working with bands of data,
something a &quot;real&quot; image processing filter is capable of (at least in
the case where no rotation or deskewing is performed).</p>

<p><b>Error Handler:</b> The error handler only handles one device error code,
HANDLED_PRIVATE_STATUS_ERROR_1. This custom device status code is sent by the
minidriver for illustrational purposes only. The minidriver also implements a
custom property, MY_WIA_ERROR_HANDLING_PROP, which enables an application to
specify which device status messages that <span class=GramE>it</span> should
send. The WiaPreview sample from the Platform SDK uses this property for
illustrational purposes only.</p>

<p><b style='mso-bidi-font-weight:normal'>UI Extension: </b>The sample provides
its own UI extension. It implements IWiaUIExtension2. This UI extension
transfers the <st1:State w:st="on"><st1:place w:st="on">Fla</st1:place></st1:State>tbed
item to a specified location.</p>

<p><b>NOTES:<o:p></o:p></b></p>

<p>This sample will work on Windows Vista and higher releases.</p>

<p>A maximum of 10 image transfers (including final and preview scans) can be
requested from the Feeder item before the driver will return
WIA_ERROR_PAPER_EMPTY. In order to reset the counter (used only for the Feeder
item) the application must change a<span style='mso-spacerun:yes'> 
</span>Feeder item property current value or reload the driver.</p>

<h3>BUILDING THE SAMPLE</h3>

<p>To build the sample, complete the following steps:</p>

<p style='margin-left:.5in;text-indent:-.25in;tab-stops:list .5in'>1.<span
style='font-size:7.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>On the <b
style='mso-bidi-font-weight:normal'>Start</b> menu, under Windows DDK, select <b
style='mso-bidi-font-weight:normal'>Free Build Environment</b> or <b
style='mso-bidi-font-weight:normal'>Checked Build Environment</b> to open a
command window and set basic environment variables needed to build drivers. </p>

<p style='margin-left:.5in;text-indent:-.25in;tab-stops:list .5in'>2.<span
style='font-size:7.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Navigate to the
directory that contains the sample driver source code (that is, the directory
where this file is located).</p>

<p style='margin-left:.5in;text-indent:-.25in;tab-stops:list .5in'>3.<span
style='font-size:7.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Run the build
command. After the build completes, the following DLLs are built:
Wiadriverex.dll, Segfilter.dll, Imgfilter.dll, Uiext2.dll, and Errhandler.dll.</p>

<h3>INSTALLING THE SAMPLE</h3>

<p>To install the sample, complete the following steps:</p>

<p style='margin-left:.5in;text-indent:-.25in;tab-stops:list .5in'>1. Open a elevated
command prompt and then type <b style='mso-bidi-font-weight:normal'>rundll32
sti_ci AddDevice</b>.</p>

<p style='margin-left:.5in;text-indent:-.25in;tab-stops:list .5in'>2. When
prompted for which scanner or camera you want to install, click <b
style='mso-bidi-font-weight:normal'>Have Disk</b>, and then navigate to the
directory that contains the driver INF file in which to install the driver and
filters.</p>

<h3>USING THE SAMPLE</h3>

<p>The WiaPreview sample application from the Platform SDK can be used to test
the sample. This application uses the WIA preview component and allows a user
to modify the brightness and contrast &quot;live.&quot; In addition, WiaPreview
enables a user to choose which device messages the monster driver should send.
You can write your own application that uses the new transport model, the WIA
Preview Component, the segmentation filter, and its own error handler. For more
information, refer to the Platform SDK.</p>

<h3>RESOURCES</h3>

<p>For information and the latest release of the Microsoft® Windows® Driver
Development Kit (DDK), see <a
href="http://www.microsoft.com/whdc/ddk/winddk.mspx">http://www.microsoft.com/whdc/ddk/winddk.mspx</a>.</p>

<p>For questions about WIA filers and error handlers, send e-mail to <a
href="mailto:wiainfo@microsoft.com">wiainfo@microsoft.com</a>.</p>

<p>For information about WIA, see <a
href="http://www.microsoft.com/whdc/device/StillImage/default.mspx">http://www.microsoft.com/whdc/device/StillImage/default.mspx</a>.</p>

<p><o:p>&nbsp;</o:p></p>

</div>

</body>

</html>
