<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/9bf1b74c-1640-46af-84d3-e440c8f95162Combined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>SharePoint 2013: Add runtime instrumentation and error logging to apps</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>SharePoint 2013: Add runtime instrumentation and error logging to apps</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            C#, REST, Javascript, apps for SharePoint
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Cloud, User Experience
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Cloud
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">3/6/2013</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/SharePoint-2013-Add-e4674cd8">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<div id="header">
<table id="bottomTable" cellspacing="0" cellpadding="0">
<tbody>
<tr id="headerTableRow1">
<td align="left"><span id="runningHeaderText">&nbsp;</span></td>
</tr>
<tr id="headerTableRow2">
<td align="left"><span id="nsrTitle">SharePoint 2013: Add runtime instrumentation and error logging to apps</span></td>
</tr>
</tbody>
</table>
</div>
<div id="mainSection">
<div id="mainBody">&lt;font color=&quot;DarkGray&quot;&gt;&lt;/font&gt;
<div>&nbsp;</div>
<div class="summary">
<div>Learn how to add custom errors to the app monitoring system and enable runtime request tracing for apps for SharePoint.</div>
</div>
<div class="introduction">
<div>This sample app for SharePoint shows how to add custom errors to the app monitoring system and how to enable runtime request tracing for the app.</div>
<div class="alert">
<table cellspacing="0" cellpadding="0" width="100%">
<tbody>
<tr>
<th align="left"><strong>Tip</strong></th>
</tr>
<tr>
<td>
<div>Before working with this sample, read <a href="http://msdn.microsoft.com/en-us/library/jj841104.aspx" >
Add troubleshooting instrumentation to an app for SharePoint</a> so that you can understand its intended use.</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<a name="O15Readme_Description">
<h1 class="heading">Description</h1>
<div class="section" id="sectionSection0">
<div>The default.aspx page of the app appears after you install and launch the app. It contains a button labeled
<span class="ui">POPULATE DATA</span>.</div>
<div class="caption">Figure 1. Default page of the app</div>
<br>
<img src="InstrumentationSampleDefaultPage.PNG" alt="The default page with Populate Data button">
<div>&nbsp;</div>
<div>Pressing the button displays the titles of all the lists on the host web and s a link to a diagnostics page.</div>
<div class="caption">Figure 2. Data and link to diagnostics page</div>
<br>
<img src="InstrumentationSamplewithDataandDiagnosticsLink.PNG" alt="Default page with sata and diagnostics link">
<div>&nbsp;</div>
<div>The button's click handler also throws an exception. The user doesn't see this exception because the code catches it and logs it using the</div>
</div>
</a>
<div class="section" id="sectionSection0">
<div><a href="http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.utilities.sputility.logcustomremoteapperror.aspx" >LogCustomRemoteAppError</a>. After a wait of about 10-15 minutes, you can see this custom error on the
<span class="ui">App Details</span> page for the app. You can open the <span class="ui">
App Details</span> page by clicking the ellipsis button (<span class="ui">&hellip;</span>) beside the app in the
<span class="ui">Site Contents</span> page of the host web. On the callout that opens, click
<span class="ui">Details</span>. Beside <span class="ui">Runtime Errors</span>, the number of runtime errors appears, as shown in Figure 3.</div>
<div class="caption">Figure 3. App Details page</div>
<br>
<img src="InstrumentationSampleAppDetailsPage.PNG" alt="App details page">
<div>&nbsp;</div>
<div>This number is a link. Choose this link to open a callout that gives details about the error.</div>
<div class="caption">Figure 4. Runtime errors callout</div>
<br>
<img src="InstrumentationSampleRuntimeErrorCallout.PNG" alt="Runtime error callout showing error details">
<div>&nbsp;</div>
<div>Return to the start page of the app, or relaunch the app and choose the <span class="ui">
POPULATE DATA</span> button again. Choose the <span class="ui">DIAGNOSTICS PAGE</span> link. On the page that opens, there is a
<span class="ui">TURN ON TRACING</span> button and a <em>disabled</em> link to the trace log. When the page loads a call to the
<a href="http://msdn.microsoft.com/en-us/library/aa334207(v=vs.71).aspx" >
Warn</a> method, it throws a warning that says &quot;This trace warning was thrown when the diagnostics page loaded.&quot;. However, this warning does not appear anywhere unless tracing is turned on. Click the button to turn on tracing and enable the link. The link opens
 the web server's trace.axd file, which logs details about requests to the server. The list is initially empty. Navigate back to the apps start page and choose the
<span class="ui">DIAGNOSTICS PAGE</span> link again. Notice that when it opens, the button label has changed to
<span class="ui">TURN OFF TRACING</span>. <em>Do not press it.</em> Choose the <span class="ui">
Trace Log</span> link to open the trace log. Because tracing is now turned on, there are some entries in the log.</div>
<div class="caption">Figure 5. The web server's trace log page</div>
<br>
<img src="InstrumentationSampleTraceLog.PNG" alt="Trace log page">
<div>&nbsp;</div>
<div>Choose the <span class="ui">View Details</span> link for a row in which the Diagnostics.aspx page was opened. Familiarize yourself with all the information that was logged about the request. Notice in particular that the custom warning appears in red.
 Users can then send the information on this page to the technical support personnel for the app.</div>
<div class="caption">Figure 6. Details of the GET request for the diagnostics page</div>
<br>
<img src="InstrumentationTraceDetailsPage.PNG" alt="Instrumentation Trace Details Page">
<div>&nbsp;</div>
</div>
<h1 class="heading">Deviations from best practices</h1>
<div class="section" id="sectionSection1">
<div>The sample is focused on demonstrating an app with runtime instrumentation, so it does not conform to all the good practices that should be used in a production app. Among other things, note the following.</div>
<ul>
<li>
<div>The app has a visible link to a diagnostics page where request tracing can be turned on and off. In a production app, users should not be able to turn on tracing except under the direction of someone from the technical support for the app because tracing
 can significantly reduce performance (for all users of the app, not just the person who turns it on). The best practice is that users should be able to open the diagnostics only by manually entering its URL in the address box of their browser. They should
 get this URL only from tech support.</div>
</li><li>
<div>The app has a way for users to turn off tracing, but there is no way to automatically turn it off if they neglect to turn it off. Because tracing can reduce performance, the best practice is to incorporate logic that will automatically turn off tracing
 after a certain period of time.</div>
</li><li>
<div>The app has minimal exception handling.</div>
</li><li>
<div>The app uses C# code on the server to toggle the visibility of some controls. Performance might be better if JavaScript was used for this purpose, thereby reducing requests to the server</div>
</li></ul>
</div>
<a name="O15Readme_Prereq">
<h1 class="heading">Prerequisites</h1>
<div class="section" id="sectionSection2">
<div>This sample requires the following:</div>
<ul>
<li>
<div>Visual Studio 2012 and SharePoint development tools in Visual Studio 2012.</div>
</li><li>
<div></div>
</li></ul>
</div>
</a>
<div class="section" id="sectionSection2">
<ul>
<li>
<div><a href="http://www.iis.net/download/WebDeploy" >Web Deploy 2.0</a> installed on the computer with Visual Studio. The version of Visual Studio and its SharePoint tools available for SharePoint 2013 should install this automatically.</div>
</li><li>
<div>A SharePoint Online (Office 365) Developer Site. For more information, see <a href="http://msdn.microsoft.com/en-us/library/fp179924(office.15).aspx" >
Sign up for an Office 365 Developer Site</a>. This is an autohosted app, and it can only be installed on a SharePoint Online Developer Site.</div>
</li></ul>
</div>
<a name="O15Readme_components">
<h1 class="heading">Key components</h1>
<div class="section" id="sectionSection3">
<ul>
<li>
<div><strong>Instrumentation</strong> project, which contains the AppManifest.xml file.</div>
</li><li>
<div><strong>InstrumentationWeb</strong> project.</div>
<ul>
<li>
<div>Default.aspx file, which contains the HTML and ASP.NET controls for the user interface of the app.</div>
</li><li>
<div>Default.aspx.cs file, which contains the C# code that uses reads SharePoint data, throws an exception, and catches and logs the exception</div>
</li><li>
<div>Diagnostics.aspx file, which controls the user interface for turning on tracing and viewing the trace log.</div>
</li><li>
<div>Diagnostics.aspx.cs file, which contains the C# code that turns tracing on and off.</div>
</li><li>
<div>ChromeLoader.js file, which gives the web application's pages the look and feel of the SharePoint host web.</div>
</li><li>
<div>Web.config, web.debug.config, and web.release,config files. (The web.config file that is packaged with the app is a merger of web.config and either web.debug.config or web.release.config.)</div>
</li></ul>
</li></ul>
</div>
</a><a name="O15Readme_config">
<h1 class="heading">Configure the sample</h1>
<div class="section" id="sectionSection4">
<div>Open the Instrumentation.sln file in Visual Studio 2012. In the <span class="ui">
Properties</span> pane of Visual Studio, change the <span><span class="keyword">Site URL</span></span> property of the app for SharePoint project in Visual Studio to the absolute URL of your SharePoint 2013 developer test site on SharePoint Online (for example,
 https://microsoft555.sharepoint.com/).</div>
</div>
</a><a name="O15Readme_build">
<h1 class="heading">Deploy the sample</h1>
<div class="section" id="sectionSection5">
<div>Follow these steps to deploy the sample.</div>
<div class="subSection">
<ol>
<li>
<div>Choose the <span class="ui">Instrumentation</span> project in <span class="ui">
Solution Explorer</span> (not the top node for the whole Visual Studio solution). On the menu bar, choose
<span class="ui">Publish</span>. (Do not choose the F5 key.)</div>
</li><li>
<div>In the <span class="ui">Publish</span> dialog box, choose the <span class="ui">
Finish</span> button. The resulting app package file has an .app extension and is saved in the
<span class="code">app.publish\version_number</span> subfolder of the bin\Debug folder of the Visual Studio project.</div>
</li></ol>
</div>
</div>
</a><a name="O15Readme_test">
<h1 class="heading">Install and test the sample</h1>
<div class="section" id="sectionSection6">
<div class="subSection">
<ol>
<li>
<div>Sign in to your SharePoint Online 2013 site as a tenant administrator.</div>
</li><li>
<div>At the top of the page, choose <span class="ui">Admin</span>, <span class="ui">
SharePoint</span>.</div>
</li><li>
<div>On the <span class="ui">SharePoint Administration Center</span> page, choose
<span class="ui">apps</span>, and then choose <span class="ui">App Catalog</span>. If you haven't already created an app catalog site collection, you will be prompted to create one.</div>
</li><li>
<div>After the app catalog site collection is created, open it, and select <span class="ui">
Apps for SharePoint</span>.</div>
</li><li>
<div>On the <span class="ui">App Catalog</span> page, choose the <span class="ui">
new item</span> link.</div>
</li><li>
<div>On the <span class="ui">Add a document</span> form, browse to your app for SharePoint package and choose the
<span class="ui">OK</span> button. A property form for new items opens.</div>
</li><li>
<div>Fill out the form as needed and choose the <span class="ui">Save</span> button. The app for SharePoint is saved in the catalog.</div>
</li><li>
<div>Browse to any website in the tenancy and choose <span class="ui">Site Contents</span> to open the
<span class="ui">Site Contents</span> page.</div>
</li><li>
<div>Choose <span class="ui">add an app</span>, and on the <span class="ui">Your Apps</span> page, find the app. If there are too many to scroll through, you can enter any part of the app title (<span class="ui">Instrumentation</span>) into the search
 box.</div>
</li><li>
<div>When you find the app, choose the <span class="ui">Details</span> link beneath it, and then on the app details page that opens, choose
<span class="ui">Add It</span>.</div>
</li><li>
<div>You are prompted to grant permissions to the app. Choose <span class="ui">
Trust It</span>.</div>
</li><li>
<div>The <span class="ui">Site Contents</span> page opens and the app is listed. For a short time, a message below the title indicates that it is being added. When this message disappears, you can choose the app icon to launch the app. (You may need to refresh
 the page to make the message disappear.)</div>
</li><li>
<div>Exercise the app as described in the sample description above.</div>
</li></ol>
</div>
</div>
</a><a name="O15Readme_Changelog">
<h1 class="heading">Change log</h1>
<div class="section" id="sectionSection7">
<div>First release: February 2013</div>
</div>
</a><a name="O15Readme_RelatedContent">
<h1 class="heading">Related content</h1>
<div class="section" id="sectionSection8">
<ul>
<li>
<div></div>
</li></ul>
</div>
</a>
<div class="section" id="sectionSection8">
<ul>
<li>
<div><a href="http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.utilities.sputility.logcustomremoteapperror.aspx" >LogCustomRemoteAppError</a></div>
</li><li>
<div><a href="http://msdn.microsoft.com/en-us/library/jj841104.aspx" >Add troubleshooting instrumentation to an app for SharePoint</a></div>
</li><li>
<div><a href="http://msdn.microsoft.com/en-us/library/fp179924(office.15).aspx" >Sign up for an Office 365 Developer Site</a></div>
</li><li>
<div><a href="http://msdn.microsoft.com/en-us/library/fp179930.aspx" >Apps for SharePoint overview</a></div>
</li></ul>
</div>
<h1 class="heading">Contact Info</h1>
<div class="section" id="sectionSection9">
<div>DocThis@microsoft.com</div>
</div>
</div>
</div>
<p><img src="description/image.png" alt=""> <img src="description/5e1a99af-e360-476e-b8c7-b0157fd8607dimage.png" alt="">
<img src="description/561d7a8c-e528-4645-8518-8bae06793ad8image.png" alt=""> <img src="description/e2682064-6e72-48b2-bf15-1c72fb3a0015image.png" alt="">
<img src="description/83639232-8fe5-4ed8-abb1-0594a70fb36eimage.png" alt=""> <img src="description/198d96e1-27de-4032-9f15-76694ff26fa4image.png" alt=""></p>

</div>


    </div>
</body>
</html>
